<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>Controle de Vendas</title>

<style>
:root{
  --bg:#f4f6f9;
  --card:#ffffff;
  --primary:#2563eb;
  --success:#16a34a;
  --danger:#dc2626;
  --warning:#f59e0b;
  --text:#111827;
  --border:#e5e7eb;
}

*{box-sizing:border-box}
html,body{height:100%}

body{
  margin:0;
  font-family:Segoe UI,Arial,sans-serif;
  background:var(--bg);
  color:var(--text);
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
}

header{
  padding:20px;
  text-align:center;
  font-size:22px;
  font-weight:bold;
  background:var(--primary);
  color:#fff;
}

/* NAV */
nav{
  display:flex;
  gap:10px;
  padding:15px;
  max-width:900px;
  margin:auto;
}

nav button{
  flex:1;
  padding:12px;
  border-radius:999px;
  border:none;
  background:var(--primary);
  color:#fff;
  font-weight:600;
  min-height:44px;
  transition:transform .06s ease, filter .2s ease, box-shadow .2s ease;
}

nav button:active{ transform:scale(.98); }
nav button.active{
  filter:brightness(.92);
  box-shadow:0 10px 22px rgba(37,99,235,.22);
}

.container{
  max-width:900px;
  margin:auto;
  padding:15px;
}

.card{
  background:var(--card);
  border-radius:20px;
  padding:20px;
  border:1px solid var(--border);
  margin-bottom:15px;
}

.hidden{display:none}

/* inputs confort√°veis no mobile */
input,select,textarea{
  width:100%;
  padding:12px;
  border-radius:14px;
  border:1px solid var(--border);
  margin-bottom:10px;
  font-size:16px; /* evita zoom no iOS e melhora toque */
}

textarea{resize:vertical}

button.action{
  width:100%;
  padding:12px;
  border-radius:14px;
  background:var(--primary);
  color:#fff;
  border:none;
  font-weight:bold;
  min-height:44px;
}

/* DASHBOARD */
.dashboard{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:15px;
}

.stat{
  background:#f9fafb;
  padding:20px;
  border-radius:18px;
  border:1px solid var(--border);
}

.stat span{
  display:block;
  font-size:28px;
  font-weight:bold;
  margin-top:8px;
}

.stat:nth-child(1) span{color:var(--warning)}
.stat:nth-child(2) span{color:var(--primary)}
.stat:nth-child(3) span{color:var(--success)}

/* VENDA */
.produto{
  display:grid;
  grid-template-columns:90px 1fr;
  gap:15px;
  border:1px solid var(--border);
  border-radius:18px;
  padding:15px;
  margin-bottom:15px;
}

.produto img{
  width:90px;
  height:90px;
  object-fit:cover;
  border-radius:14px;
  background:#e5e7eb;
}

/* HIST√ìRICO */
.historico-item{
  border:1px solid var(--border);
  border-radius:18px;
  padding:12px;
  margin-bottom:12px;
}

.historico-header{
  display:grid;
  grid-template-columns:70px 1fr 80px 24px;
  align-items:center;
  gap:8px;
}

.historico-header img{
  width:70px;
  height:70px;
  object-fit:cover;
  border-radius:14px;
}

.seta{
  font-size:18px;
  text-align:center;
  cursor:pointer;
}

.historico-detalhes{
  margin-top:10px;
  padding-top:10px;
  border-top:1px dashed var(--border);
  display:none;
}

/* ==========================
   MOBILE: ficar ‚Äúde celular‚Äù
   ========================== */
@media (max-width: 520px){
  header{ padding:16px; font-size:20px; }

  nav{
    padding:12px;
    gap:12px;
    flex-wrap:wrap; /* vira 2 linhas */
  }

  nav button{
    flex:1 1 calc(50% - 12px); /* 2 colunas */
    padding:14px;
    font-size:14px;
  }

  .container{ padding:12px; }
  .card{ padding:16px; border-radius:18px; }

  /* dashboard em 1 coluna no celular */
  .dashboard{
    grid-template-columns:1fr;
    gap:12px;
  }
  .stat{ padding:16px; }
  .stat span{ font-size:32px; }

  .historico-header{
    grid-template-columns:70px 1fr 60px 24px;
  }
}

/* muito pequeno: produto vira ‚Äúempilhado‚Äù pra caber inputs */
@media (max-width: 420px){
  .produto{
    grid-template-columns:1fr;
  }
  .produto img{
    width:100%;
    height:180px;
  }
}
</style>
</head>

<body>

<header>üí∞ Controle de Vendas</header>

<nav>
  <button class="nav-btn active" onclick="mostrar('dashboard', this)">Dashboard</button>
  <button class="nav-btn" onclick="mostrar('cadastro', this)">Cadastrar</button>
  <button class="nav-btn" onclick="mostrar('venda', this)">Vender</button>
  <button class="nav-btn" onclick="mostrar('historico', this)">Hist√≥rico</button>
</nav>

<div class="container">

<!-- DASHBOARD -->
<div id="dashboard" class="card">
  <div class="dashboard">
    <div class="stat">Produtos em estoque<span id="qtd">0</span></div>
    <div class="stat">Valor em estoque<span>R$ <span id="valorEstoque">0.00</span></span></div>
    <div class="stat">Lucro total<span>R$ <span id="lucro">0.00</span></span></div>
  </div>
</div>

<!-- CADASTRO -->
<div id="cadastro" class="card hidden">
  <input id="nomeProduto" placeholder="Nome do produto">
  <input id="valorCompra" type="number" placeholder="Valor de compra">
  <input type="file" accept="image/*" onchange="carregarImagem(event)">
  <button class="action" onclick="cadastrar()">Cadastrar Produto</button>
</div>

<!-- VENDA (agora √© card, pra preencher bonito) -->
<div id="venda" class="card hidden"></div>

<!-- HIST√ìRICO -->
<div id="historico" class="card hidden">

<select id="filtroMes" onchange="atualizarHistorico()">
  <option value="">Todos os meses</option>
  <option value="0">Janeiro</option>
  <option value="1">Fevereiro</option>
  <option value="2">Mar√ßo</option>
  <option value="3">Abril</option>
  <option value="4">Maio</option>
  <option value="5">Junho</option>
  <option value="6">Julho</option>
  <option value="7">Agosto</option>
  <option value="8">Setembro</option>
  <option value="9">Outubro</option>
  <option value="10">Novembro</option>
  <option value="11">Dezembro</option>
</select>

<div id="historicoLista"></div>
</div>

</div>

<script>
let estoque=[];
let historico=[];
let lucroTotal=0;
let imagemTemp=null;

/* ===== STORAGE ===== */
function salvarDados(){
  localStorage.setItem("estoque",JSON.stringify(estoque));
  localStorage.setItem("historico",JSON.stringify(historico));
  localStorage.setItem("lucroTotal",lucroTotal);
}

function carregarDados(){
  estoque=JSON.parse(localStorage.getItem("estoque"))||[];
  historico=JSON.parse(localStorage.getItem("historico"))||[];
  lucroTotal=parseFloat(localStorage.getItem("lucroTotal"))||0;
  atualizarDashboard();
  atualizarHistorico();
}

/* ===== NAV + bot√£o ativo ===== */
function mostrar(id, btn){
  document.querySelectorAll('.card').forEach(e=>e.classList.add('hidden'));
  document.getElementById(id).classList.remove('hidden');

  // ativo
  document.querySelectorAll('.nav-btn').forEach(b=>b.classList.remove('active'));
  if(btn) btn.classList.add('active');

  if(id==="venda") renderVenda();
}

/* ===== CADASTRO ===== */
function carregarImagem(e){
  const r=new FileReader();
  r.onload=()=>imagemTemp=r.result;
  r.readAsDataURL(e.target.files[0]);
}

function cadastrar(){
  if(!nomeProduto.value||!valorCompra.value) return alert("Preencha tudo");
  estoque.push({nome:nomeProduto.value,compra:+valorCompra.value,imagem:imagemTemp});
  nomeProduto.value="";
  valorCompra.value="";
  imagemTemp=null;
  salvarDados();
  atualizarDashboard();
}

/* ===== VENDA ===== */
function renderVenda(){
  venda.innerHTML="";
  if(estoque.length === 0){
    venda.innerHTML = "<div style='opacity:.7'>Nenhum produto em estoque para vender.</div>";
    return;
  }

  estoque.forEach((p,i)=>{
    venda.innerHTML+=`
    <div class="produto">
      <img src="${p.imagem||''}">
      <div>
        <strong>${p.nome}</strong><br>
        <small>Custo: R$ ${p.compra.toFixed(2)}</small>
        <input type="date" id="data-${i}">
        <input type="number" placeholder="Valor de venda" id="venda-${i}">
        <textarea placeholder="Nota / Detalhes" id="nota-${i}"></textarea>
        <button class="action" style="background:var(--success)" onclick="vender(${i})">Vender</button>
      </div>
    </div>`;
  });
}

function vender(i){
  const v=parseFloat(document.getElementById(`venda-${i}`).value);
  if(!v) return alert("Informe o valor");

  const p=estoque[i];
  const nota=document.getElementById(`nota-${i}`).value;
  const dataInput=document.getElementById(`data-${i}`).value;
  const dataVenda=dataInput?new Date(dataInput+"T12:00"):new Date();

  lucroTotal+=v-p.compra;

  historico.push({
    ...p,
    venda:v,
    nota,
    data:dataVenda.toLocaleDateString("pt-BR"),
    mes:dataVenda.getMonth(),
    ts:dataVenda.getTime()
  });

  estoque.splice(i,1);
  salvarDados();
  renderVenda();
  atualizarDashboard();
  atualizarHistorico();
}

/* ===== DASHBOARD ===== */
function atualizarDashboard(){
  qtd.textContent=estoque.length;
  valorEstoque.textContent=estoque.reduce((s,p)=>s+p.compra,0).toFixed(2);
  lucro.textContent=lucroTotal.toFixed(2);
}

/* ===== HIST√ìRICO ===== */
function atualizarHistorico(){
  const mes=filtroMes.value;
  historicoLista.innerHTML="";

  const lista = historico
    .slice()
    .sort((a,b)=>b.ts-a.ts)
    .filter(h=>mes===""||h.mes==mes);

  if(lista.length === 0){
    historicoLista.innerHTML = "<div style='opacity:.7'>Nenhuma venda registrada.</div>";
    return;
  }

  lista.forEach((h,i)=>{
    historicoLista.innerHTML+=`
    <div class="historico-item">
      <div class="historico-header">
        <img src="${h.imagem||''}">
        <strong onclick="toggleDetalhes(${i})">${h.nome}</strong>
        <div onclick="toggleDetalhes(${i})">${h.data}</div>
        <div class="seta" id="seta-${i}" onclick="toggleDetalhes(${i})">‚ñ∂</div>
      </div>

      <div class="historico-detalhes" id="detalhes-${i}">
        <p>Compra: R$ ${h.compra.toFixed(2)}</p>
        <p>Venda: R$ ${h.venda.toFixed(2)}</p>
        <p>Lucro: R$ ${(h.venda-h.compra).toFixed(2)}</p>
        <p>Nota: ${h.nota||'-'}</p>
        <button class="action" style="background:var(--danger)" onclick="excluirVenda(${i})">Excluir</button>
      </div>
    </div>`;
  });
}

function toggleDetalhes(i){
  const d=document.getElementById(`detalhes-${i}`);
  const s=document.getElementById(`seta-${i}`);
  const aberto=d.style.display==="block";
  d.style.display=aberto?"none":"block";
  s.textContent=aberto?"‚ñ∂":"‚ñº";
}

function excluirVenda(i){
  if(!confirm("Excluir esta venda?")) return;
  const lista = historico.slice().sort((a,b)=>b.ts-a.ts);
  const item = lista[i];
  // remove o item real do historico original
  const idxReal = historico.findIndex(h => h.ts === item.ts && h.nome === item.nome && h.venda === item.venda);
  if(idxReal >= 0){
    const h=historico[idxReal];
    lucroTotal-=(h.venda-h.compra);
    historico.splice(idxReal,1);
  }
  salvarDados();
  atualizarDashboard();
  atualizarHistorico();
}

/* INIT */
carregarDados();
</script>

</body>
</html>
