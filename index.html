<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Controle de Vendas</title>
  <style>
    :root{
      --blue:#1f5fd7;
      --blue2:#2b74ff;
      --bg:#f4f7ff;
      --card:#ffffff;
      --text:#0f172a;
      --muted:#64748b;
      --shadow: 0 10px 30px rgba(2,6,23,.12);
      --radius: 18px;
      --btnRadius: 28px;

      --orange:#f59e0b;
      --green:#16a34a;
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      background: radial-gradient(900px 500px at 30% -10%, rgba(43,116,255,.20), transparent 55%),
                  radial-gradient(900px 500px at 90% 0%, rgba(31,95,215,.12), transparent 55%),
                  var(--bg);
      color:var(--text);
    }

    /* Top bar */
    .topbar{
      position: sticky;
      top: 0;
      z-index: 10;
      background: linear-gradient(180deg, var(--blue2), var(--blue));
      padding: 14px 16px 16px;
      box-shadow: 0 10px 30px rgba(2,6,23,.18);
    }
    .title{
      color:#fff;
      font-weight: 900;
      letter-spacing:.2px;
      font-size: 22px;
      display:flex;
      align-items:center;
      gap:10px;
      justify-content:center;
    }
    .title .emoji{
      font-size: 22px;
      filter: drop-shadow(0 6px 10px rgba(0,0,0,.18));
    }

    .wrap{
      max-width: 560px;
      margin: 0 auto;
      padding: 14px 14px 22px;
    }

    /* 4 big buttons */
    .navGrid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 14px;
      margin-top: -8px;
      margin-bottom: 14px;
    }
    .navBtn{
      border:0;
      cursor:pointer;
      padding: 18px 14px;
      border-radius: var(--btnRadius);
      color:#fff;
      font-weight: 900;
      font-size: 16px;
      background: linear-gradient(180deg, rgba(43,116,255,1), rgba(31,95,215,1));
      box-shadow: 0 12px 26px rgba(31,95,215,.25);
      transition: transform .06s ease;
    }
    .navBtn:active{ transform: translateY(1px); }
    .navBtn.active{
      outline: 3px solid rgba(255,255,255,.55);
      box-shadow: 0 16px 34px rgba(31,95,215,.30);
    }

    /* card container (white) */
    .panel{
      background: rgba(255,255,255,.60);
      border: 1px solid rgba(15,23,42,.06);
      border-radius: 22px;
      padding: 14px;
      box-shadow: 0 12px 30px rgba(2,6,23,.10);
    }

    .card{
      background: var(--card);
      border: 1px solid rgba(15,23,42,.06);
      border-radius: 18px;
      padding: 18px;
      box-shadow: 0 10px 22px rgba(2,6,23,.08);
      margin-bottom: 14px;
    }
    .card:last-child{ margin-bottom:0; }

    .label{
      color: var(--muted);
      font-weight: 800;
      font-size: 14px;
      margin-bottom: 10px;
    }
    .big{
      font-size: 42px;
      font-weight: 950;
      letter-spacing: .2px;
      line-height: 1;
    }
    .big.orange{ color: var(--orange); }
    .big.blue{ color: var(--blue); }
    .big.green{ color: var(--green); }

    /* forms */
    .sectionTitle{
      font-weight: 950;
      font-size: 18px;
      margin: 0 0 10px;
    }
    .muted{ color: var(--muted); font-size: 13px; line-height: 1.35; }

    .row{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }
    @media (max-width: 420px){
      .row{ grid-template-columns: 1fr; }
    }

    label{
      display:block;
      margin: 10px 0 6px;
      color: var(--muted);
      font-size: 12px;
      font-weight: 900;
    }
    input, textarea, select{
      width: 100%;
      border-radius: 14px;
      border: 1px solid rgba(15,23,42,.10);
      padding: 12px 12px;
      font-size: 14px;
      outline:none;
      background: #fff;
    }
    textarea{ min-height: 90px; resize: vertical; }

    .actions{
      display:flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-top: 12px;
    }
    .btn{
      border:0;
      cursor:pointer;
      padding: 12px 14px;
      border-radius: 14px;
      font-weight: 950;
      font-size: 14px;
      box-shadow: 0 10px 20px rgba(2,6,23,.10);
    }
    .btn.primary{
      color:#fff;
      background: linear-gradient(180deg, rgba(43,116,255,1), rgba(31,95,215,1));
    }
    .btn.ghost{
      background:#fff;
      border: 1px solid rgba(15,23,42,.10);
      box-shadow:none;
    }
    .btn.danger{
      color:#fff;
      background: linear-gradient(180deg, #ff4d6d, #ff2d55);
    }
    .btn.ok{
      color:#fff;
      background: linear-gradient(180deg, #22c55e, #16a34a);
    }

    /* lists */
    .list{
      display:grid;
      gap: 10px;
      margin-top: 12px;
    }
    .item{
      background:#fff;
      border: 1px solid rgba(15,23,42,.08);
      border-radius: 16px;
      padding: 12px;
      box-shadow: 0 8px 18px rgba(2,6,23,.08);
    }
    .itemTop{
      display:flex;
      justify-content:space-between;
      gap: 10px;
      align-items:flex-start;
    }
    .itemName{
      font-weight: 950;
      font-size: 15px;
      margin-bottom: 6px;
    }
    .meta{
      display:flex;
      flex-wrap: wrap;
      gap: 8px;
      color: var(--muted);
      font-size: 12px;
      font-weight: 800;
    }
    .chip{
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(15,23,42,.08);
      background: rgba(2,6,23,.02);
    }
    .itemBtns{
      display:flex;
      gap: 8px;
      flex-wrap: wrap;
      justify-content:flex-end;
    }
    .mini{
      padding: 8px 10px;
      font-size: 12px;
      border-radius: 12px;
      box-shadow:none;
    }

    /* toast */
    .toast{
      position: fixed;
      left: 50%;
      bottom: 18px;
      transform: translateX(-50%);
      background: rgba(15,23,42,.92);
      color: #fff;
      padding: 10px 12px;
      border-radius: 12px;
      font-weight: 900;
      display:none;
      z-index: 30;
    }

    /* hidden pages */
    .hidden{ display:none !important; }

    /* small status (optional) */
    .sync{
      text-align:center;
      color: rgba(255,255,255,.85);
      font-weight: 800;
      font-size: 12px;
      margin-top: 6px;
      opacity: .95;
    }
  </style>
</head>

<body>
  <div class="topbar">
    <div class="title"><span class="emoji">üí∞</span> Controle de Vendas</div>
    <div class="sync" id="syncText">Pronto</div>
  </div>

  <div class="wrap">
    <div class="navGrid">
      <button class="navBtn active" data-page="dashboard">Dashboard</button>
      <button class="navBtn" data-page="cadastrar">Cadastrar</button>
      <button class="navBtn" data-page="vender">Vender</button>
      <button class="navBtn" data-page="historico">Hist√≥rico</button>
    </div>

    <!-- DASHBOARD -->
    <div class="panel" id="page-dashboard">
      <div class="card">
        <div class="label">Produtos em estoque</div>
        <div class="big orange" id="mStock">0</div>
      </div>

      <div class="card">
        <div class="label">Valor em estoque</div>
        <div class="big blue" id="mStockValue">R$ 0,00</div>
      </div>

      <div class="card">
        <div class="label">Lucro total</div>
        <div class="big green" id="mProfit">R$ 0,00</div>
      </div>
    </div>

    <!-- CADASTRAR -->
    <div class="panel hidden" id="page-cadastrar">
      <h2 class="sectionTitle">Cadastrar produto</h2>
      <div class="muted">Cadastre seus produtos usados para controlar estoque e lucro.</div>

      <input type="hidden" id="pId" />

      <label>Nome do produto</label>
      <input id="pName" type="text" placeholder="Ex: iPhone 12 (usado)" />

      <div class="row">
        <div>
          <label>Pre√ßo de custo (R$)</label>
          <input id="pCost" type="number" step="0.01" inputmode="decimal" />
        </div>
        <div>
          <label>Pre√ßo de venda sugerido (R$)</label>
          <input id="pPrice" type="number" step="0.01" inputmode="decimal" />
        </div>
      </div>

      <div class="row">
        <div>
          <label>Quantidade</label>
          <input id="pQty" type="number" step="1" min="0" inputmode="numeric" value="1"/>
        </div>
        <div>
          <label>&nbsp;</label>
          <button class="btn ghost" id="btnNovo">Novo cadastro</button>
        </div>
      </div>

      <label>Observa√ß√µes</label>
      <textarea id="pNotes" placeholder="Ex: leve arranh√£o na lateral..."></textarea>

      <div class="actions">
        <button class="btn primary" id="btnSalvarProduto">Salvar</button>
        <button class="btn danger" id="btnLimparTudo">Limpar tudo</button>
        <button class="btn ghost" id="btnBackup">Backup</button>
      </div>

      <div class="list" id="listProducts"></div>
    </div>

    <!-- VENDER -->
    <div class="panel hidden" id="page-vender">
      <h2 class="sectionTitle">Vender</h2>
      <div class="muted">Selecione um produto, informe quantidade e pre√ßo de venda.</div>

      <label>Produto</label>
      <select id="sellProduct"></select>

      <div class="row">
        <div>
          <label>Quantidade</label>
          <input id="sellQty" type="number" step="1" min="1" inputmode="numeric" value="1"/>
        </div>
        <div>
          <label>Pre√ßo de venda (R$)</label>
          <input id="sellPrice" type="number" step="0.01" inputmode="decimal" />
        </div>
      </div>

      <label>Comprador / Observa√ß√µes</label>
      <input id="sellBuyer" type="text" placeholder="Opcional" />

      <div class="actions">
        <button class="btn ok" id="btnConfirmSale">Confirmar venda</button>
        <button class="btn ghost" id="btnGoDashboard">Voltar</button>
      </div>

      <div class="muted" id="sellHint" style="margin-top:10px"></div>
    </div>

    <!-- HIST√ìRICO -->
    <div class="panel hidden" id="page-historico">
      <h2 class="sectionTitle">Hist√≥rico de vendas</h2>
      <div class="muted">Aqui ficam as vendas registradas (voc√™ pode remover se precisar).</div>

      <div class="actions" style="margin-top:10px">
        <button class="btn ghost" id="btnBackup2">Backup</button>
      </div>

      <div class="list" id="listSales"></div>
    </div>
  </div>

  <!-- BACKUP simples -->
  <div class="toast" id="toast"></div>

<script>
/* =========================
   Estado + Persist√™ncia
========================= */
const STORAGE_KEY = "cvusados_state_v1";
let state = { v: 1, updatedAt: Date.now(), products: [], sales: [] };

let lastSyncedB64 = "";
let receivedKodularData = false;
let applyingExternal = false;

const $ = (s) => document.querySelector(s);

function now(){ return Date.now(); }
function uid(){ return Math.random().toString(16).slice(2) + "-" + Date.now().toString(16); }
function toNumber(v){
  const n = Number(String(v ?? "").replace(",", "."));
  return Number.isFinite(n) ? n : 0;
}
function moneyBRL(n){
  const v = Number(n || 0);
  return v.toLocaleString("pt-BR", { style:"currency", currency:"BRL" });
}

/* Base64 seguro UTF-8 */
function b64EncodeUnicode(str){
  const bytes = new TextEncoder().encode(str);
  let bin = "";
  bytes.forEach(b => bin += String.fromCharCode(b));
  return btoa(bin);
}
function b64DecodeUnicode(b64){
  const bin = atob(b64);
  const bytes = Uint8Array.from(bin, c => c.charCodeAt(0));
  return new TextDecoder().decode(bytes);
}
function stateToB64(s){ return b64EncodeUnicode(JSON.stringify(s)); }
function b64ToState(b64){ return JSON.parse(b64DecodeUnicode(b64)); }

function setSync(text){ $("#syncText").textContent = text; }

function loadFromLocalStorage(){
  try{
    const raw = localStorage.getItem(STORAGE_KEY);
    if(!raw) return false;
    const parsed = JSON.parse(raw);
    if(!parsed || !parsed.products || !parsed.sales) return false;
    state = parsed;
    return true;
  }catch(e){ return false; }
}
function saveToLocalStorage(){
  try{ localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); }catch(e){}
}

/* manda Base64 pro Kodular */
function syncToKodular(){
  if(applyingExternal) return;
  const b64 = stateToB64(state);
  if(b64 === lastSyncedB64) return;
  lastSyncedB64 = b64;

  if(window.AppInventor && typeof window.AppInventor.setWebViewString === "function"){
    window.AppInventor.setWebViewString(b64);
    setSync("Salvo");
  }else{
    setSync("Salvo (web)");
  }
}

function commit(){
  state.updatedAt = now();
  saveToLocalStorage();
  syncToKodular();
}

/* =========================
   API p/ Kodular restaurar
========================= */
window.loadFromKodularB64 = function(b64){
  try{
    if(!b64 || typeof b64 !== "string") return false;
    receivedKodularData = true;
    applyingExternal = true;

    const incoming = b64ToState(b64);
    if(incoming && incoming.products && incoming.sales){
      state = incoming;
      saveToLocalStorage();
      renderAll();
      lastSyncedB64 = b64; // evita eco
      toast("Dados restaurados");
      setSync("Restaurado");
      return true;
    }
    return false;
  }catch(e){
    toast("Backup inv√°lido");
    return false;
  }finally{
    applyingExternal = false;
  }
};

/* =========================
   Navega√ß√£o (4 bot√µes)
========================= */
const navBtns = Array.from(document.querySelectorAll(".navBtn"));
const pages = {
  dashboard: $("#page-dashboard"),
  cadastrar: $("#page-cadastrar"),
  vender: $("#page-vender"),
  historico: $("#page-historico")
};

function showPage(name){
  navBtns.forEach(b => b.classList.toggle("active", b.dataset.page === name));
  Object.keys(pages).forEach(k => pages[k].classList.toggle("hidden", k !== name));

  if(name === "vender"){
    refreshSellForm();
  }
  if(name === "dashboard"){
    renderDashboard();
  }
  if(name === "historico"){
    renderSales();
  }
  if(name === "cadastrar"){
    renderProducts();
  }
}

navBtns.forEach(btn => btn.addEventListener("click", () => showPage(btn.dataset.page)));

/* =========================
   Dashboard m√©tricas
========================= */
function calcMetrics(){
  const stockUnits = state.products.reduce((a,p)=> a + (Number(p.qty)||0), 0);

  // Valor em estoque: custo * qty (investimento)
  const stockValue = state.products.reduce((a,p)=> a + (toNumber(p.cost) * (Number(p.qty)||0)), 0);

  const profit = state.sales.reduce((a,s)=> a + (toNumber(s.profit)||0), 0);

  return { stockUnits, stockValue, profit };
}

function renderDashboard(){
  const m = calcMetrics();
  $("#mStock").textContent = m.stockUnits;
  $("#mStockValue").textContent = moneyBRL(m.stockValue);
  $("#mProfit").textContent = moneyBRL(m.profit);
}

/* =========================
   Produtos (Cadastrar)
========================= */
function clearProductForm(){
  $("#pId").value = "";
  $("#pName").value = "";
  $("#pCost").value = "";
  $("#pPrice").value = "";
  $("#pQty").value = 1;
  $("#pNotes").value = "";
}

function upsertProduct(){
  const id = $("#pId").value || uid();
  const name = $("#pName").value.trim();
  const cost = toNumber($("#pCost").value);
  const price = toNumber($("#pPrice").value);
  const qty = Math.max(0, Math.floor(toNumber($("#pQty").value)));
  const notes = $("#pNotes").value.trim();

  if(!name){ toast("Informe o nome"); $("#pName").focus(); return; }

  const idx = state.products.findIndex(p => p.id === id);
  const obj = { id, name, cost, price, qty, notes, updatedAt: now() };

  if(idx >= 0) state.products[idx] = { ...state.products[idx], ...obj };
  else state.products.push({ ...obj, createdAt: now() });

  commit();
  renderAll();
  toast("Salvo!");
  clearProductForm();
}

function deleteProduct(id){
  const p = state.products.find(x=>x.id===id);
  if(!p) return;
  if(!confirm(`Excluir "${p.name}"?`)) return;
  state.products = state.products.filter(x=>x.id!==id);
  commit();
  renderAll();
  toast("Removido");
}

function editProduct(id){
  const p = state.products.find(x=>x.id===id);
  if(!p) return;
  $("#pId").value = p.id;
  $("#pName").value = p.name || "";
  $("#pCost").value = p.cost ?? "";
  $("#pPrice").value = p.price ?? "";
  $("#pQty").value = p.qty ?? 0;
  $("#pNotes").value = p.notes || "";
  toast("Editando‚Ä¶");
}

function renderProducts(){
  const box = $("#listProducts");
  box.innerHTML = "";

  if(state.products.length === 0){
    box.innerHTML = `<div class="item">
      <div class="itemName">Nenhum produto cadastrado</div>
      <div class="meta"><span class="chip">Cadastre acima</span></div>
    </div>`;
    return;
  }

  const products = [...state.products].sort((a,b)=> (a.name||"").localeCompare(b.name||""));
  for(const p of products){
    const div = document.createElement("div");
    div.className = "item";
    div.innerHTML = `
      <div class="itemTop">
        <div>
          <div class="itemName">${escapeHtml(p.name || "")}</div>
          <div class="meta">
            <span class="chip">Qtd: <b>${Number(p.qty)||0}</b></span>
            <span class="chip">Custo: <b>${moneyBRL(p.cost)}</b></span>
            <span class="chip">Venda: <b>${moneyBRL(p.price)}</b></span>
          </div>
          ${p.notes ? `<div class="muted" style="margin-top:8px">${escapeHtml(p.notes)}</div>` : ``}
        </div>
        <div class="itemBtns">
          <button class="btn mini ok" data-act="sell">Vender</button>
          <button class="btn mini ghost" data-act="edit">Editar</button>
          <button class="btn mini danger" data-act="del">Excluir</button>
        </div>
      </div>
    `;
    div.querySelector('[data-act="sell"]').addEventListener("click", ()=>{
      showPage("vender");
      $("#sellProduct").value = p.id;
      refreshSellForm(true);
    });
    div.querySelector('[data-act="edit"]').addEventListener("click", ()=> editProduct(p.id));
    div.querySelector('[data-act="del"]').addEventListener("click", ()=> deleteProduct(p.id));
    box.appendChild(div);
  }
}

/* =========================
   Vender
========================= */
function refreshSellOptions(){
  const sel = $("#sellProduct");
  const current = sel.value;
  sel.innerHTML = "";

  const products = state.products
    .filter(p => (Number(p.qty)||0) > 0)
    .sort((a,b)=> (a.name||"").localeCompare(b.name||""));

  if(products.length === 0){
    sel.innerHTML = `<option value="">(Sem estoque)</option>`;
    return;
  }

  for(const p of products){
    const opt = document.createElement("option");
    opt.value = p.id;
    opt.textContent = `${p.name} (Qtd: ${Number(p.qty)||0})`;
    sel.appendChild(opt);
  }

  if(current && products.some(p=>p.id===current)) sel.value = current;
}

function refreshSellForm(keepQty){
  refreshSellOptions();
  const id = $("#sellProduct").value;
  const p = state.products.find(x=>x.id===id);

  if(!p){
    $("#sellHint").textContent = "Voc√™ precisa ter produtos em estoque para vender.";
    $("#btnConfirmSale").disabled = true;
    return;
  }

  $("#btnConfirmSale").disabled = false;
  if(!keepQty) $("#sellQty").value = 1;
  $("#sellPrice").value = p.price ?? 0;

  $("#sellHint").textContent = `Em estoque: ${Number(p.qty)||0} ‚Ä¢ Custo: ${moneyBRL(p.cost)} ‚Ä¢ Venda sugerida: ${moneyBRL(p.price)}`;
}

$("#sellProduct").addEventListener("change", ()=> refreshSellForm(false));

function confirmSale(){
  const id = $("#sellProduct").value;
  const p = state.products.find(x=>x.id===id);
  if(!p){ toast("Selecione um produto"); return; }

  const qty = Math.max(1, Math.floor(toNumber($("#sellQty").value)));
  if(qty > (Number(p.qty)||0)){ toast("Quantidade maior que o estoque"); return; }

  const price = Math.max(0, toNumber($("#sellPrice").value));
  const buyer = $("#sellBuyer").value.trim();

  const profit = (price - toNumber(p.cost)) * qty;

  p.qty = (Number(p.qty)||0) - qty;
  p.updatedAt = now();

  state.sales.push({
    id: uid(),
    productId: p.id,
    productName: p.name,
    qty,
    price,
    buyer,
    date: now(),
    profit
  });

  commit();
  renderAll();
  toast("Venda registrada!");
  $("#sellBuyer").value = "";
  refreshSellForm(false);
}

/* =========================
   Hist√≥rico
========================= */
function renderSales(){
  const box = $("#listSales");
  box.innerHTML = "";

  if(state.sales.length === 0){
    box.innerHTML = `<div class="item">
      <div class="itemName">Nenhuma venda registrada</div>
      <div class="meta"><span class="chip">Use a aba Vender</span></div>
    </div>`;
    return;
  }

  const sales = [...state.sales].sort((a,b)=> (b.date||0) - (a.date||0));
  for(const s of sales){
    const dt = new Date(s.date || Date.now()).toLocaleString("pt-BR");
    const div = document.createElement("div");
    div.className = "item";
    div.innerHTML = `
      <div class="itemTop">
        <div>
          <div class="itemName">${escapeHtml(s.productName || "Venda")}</div>
          <div class="meta">
            <span class="chip">Qtd: <b>${Number(s.qty)||0}</b></span>
            <span class="chip">Pre√ßo: <b>${moneyBRL(s.price)}</b></span>
            <span class="chip">Lucro: <b>${moneyBRL(s.profit)}</b></span>
            <span class="chip">${dt}</span>
          </div>
          ${s.buyer ? `<div class="muted" style="margin-top:8px">${escapeHtml(s.buyer)}</div>` : ``}
        </div>
        <div class="itemBtns">
          <button class="btn mini danger" data-act="del">Remover</button>
        </div>
      </div>
    `;
    div.querySelector('[data-act="del"]').addEventListener("click", ()=> deleteSale(s.id));
    box.appendChild(div);
  }
}

function deleteSale(id){
  if(!confirm("Remover essa venda?")) return;
  state.sales = state.sales.filter(s=>s.id!==id);
  commit();
  renderAll();
  toast("Removida");
}

/* =========================
   Backup / Limpar
========================= */
function showBackup(){
  const b64 = stateToB64(state);
  // simples: mostra num prompt pra copiar/colar
  const txt = prompt("Backup (Base64) - COPIE e guarde:", b64);
  // se colar um Base64 diferente no prompt e clicar OK, restaura
  if(txt && txt.trim() && txt.trim() !== b64){
    if(confirm("Restaurar esse backup e substituir seus dados atuais?")){
      window.loadFromKodularB64(txt.trim());
      commit();
    }
  }
}

function clearAll(){
  if(!confirm("Apagar TUDO (estoque + hist√≥rico)?")) return;
  state.products = [];
  state.sales = [];
  commit();
  renderAll();
  toast("Tudo apagado");
  clearProductForm();
}

/* =========================
   Utils
========================= */
function escapeHtml(str){
  return String(str).replace(/[&<>"']/g, (m)=>({
    "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
  }[m]));
}
function toast(msg){
  const t = $("#toast");
  t.textContent = msg;
  t.style.display = "block";
  clearTimeout(toast._timer);
  toast._timer = setTimeout(()=> t.style.display="none", 1600);
}

/* =========================
   Eventos
========================= */
$("#btnSalvarProduto").addEventListener("click", upsertProduct);
$("#btnNovo").addEventListener("click", ()=> { clearProductForm(); toast("Novo cadastro"); });
$("#btnConfirmSale").addEventListener("click", confirmSale);
$("#btnGoDashboard").addEventListener("click", ()=> showPage("dashboard"));
$("#btnLimparTudo").addEventListener("click", clearAll);
$("#btnBackup").addEventListener("click", showBackup);
$("#btnBackup2").addEventListener("click", showBackup);

/* =========================
   Init
========================= */
function renderAll(){
  renderDashboard();
  renderProducts();
  renderSales();
}

function init(){
  loadFromLocalStorage();
  renderAll();

  // IMPORTANT√çSSIMO:
  // n√£o enviar pro Kodular imediatamente (pra n√£o sobrescrever o TinyDB antes de voc√™ restaurar)
  setTimeout(()=>{
    if(!receivedKodularData){
      syncToKodular();
      setSync("Pronto");
    }
  }, 2000);

  showPage("dashboard");
}
init();
</script>
</body>
</html>
