<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Controle de Vendas</title>


<style>
:root{
  --bg:#f4f6f9;
  --card:#ffffff;
  --primary:#2563eb;
  --success:#16a34a;
  --danger:#dc2626;
  --warning:#f59e0b;
  --text:#111827;
  --border:#e5e7eb;
}


*{box-sizing:border-box}


body{
  margin:0;
  font-family:Segoe UI,Arial,sans-serif;
  background:var(--bg);
  color:var(--text);
}


header{
  padding:20px;
  text-align:center;
  font-size:22px;
  font-weight:bold;
  background:var(--primary);
  color:#fff;
}


nav{
  display:flex;
  gap:10px;
  padding:15px;
  max-width:900px;
  margin:auto;
}


nav button{
  flex:1;
  padding:12px;
  border-radius:20px;
  border:none;
  background:var(--primary);
  color:#fff;
  font-weight:600;
}


.container{
  max-width:900px;
  margin:auto;
  padding:15px;
}


.card{
  background:var(--card);
  border-radius:20px;
  padding:20px;
  border:1px solid var(--border);
  margin-bottom:15px;
}


.hidden{display:none}


input,select,textarea{
  width:100%;
  padding:12px;
  border-radius:14px;
  border:1px solid var(--border);
  margin-bottom:10px;
}


textarea{resize:vertical}


button.action{
  width:100%;
  padding:12px;
  border-radius:14px;
  background:var(--primary);
  color:#fff;
  border:none;
  font-weight:bold;
}


/* DASHBOARD */
.dashboard{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:15px;
}


.stat{
  background:#f9fafb;
  padding:20px;
  border-radius:18px;
  border:1px solid var(--border);
}


.stat span{
  display:block;
  font-size:26px;
  font-weight:bold;
  margin-top:8px;
}


.stat:nth-child(1) span{color:var(--warning)}
.stat:nth-child(2) span{color:var(--primary)}
.stat:nth-child(3) span{color:var(--success)}


/* VENDA */
.produto{
  display:grid;
  grid-template-columns:90px 1fr;
  gap:15px;
  border:1px solid var(--border);
  border-radius:18px;
  padding:15px;
  margin-bottom:15px;
}


.produto img{
  width:90px;
  height:90px;
  object-fit:cover;
  border-radius:14px;
  background:#e5e7eb;
}


/* HISTÓRICO */
.historico-item{
  border:1px solid var(--border);
  border-radius:18px;
  padding:12px;
  margin-bottom:12px;
}


.historico-header{
  display:grid;
  grid-template-columns:70px 1fr 70px 24px;
  align-items:center;
  gap:6px;
}


.historico-header img{
  width:70px;
  height:70px;
  object-fit:cover;
  border-radius:14px;
}


.seta{
  font-size:18px;
  text-align:center;
  cursor:pointer;
}


.historico-detalhes{
  margin-top:10px;
  padding-top:10px;
  border-top:1px dashed var(--border);
  display:none;
}
</style>
</head>


<body>


<header>💰 Controle de Vendas</header>


<nav>
  <button onclick="mostrar('dashboard')">Dashboard</button>
  <button onclick="mostrar('cadastro')">Cadastrar</button>
  <button onclick="mostrar('venda')">Vender</button>
  <button onclick="mostrar('historico')">Histórico</button>
</nav>


<div class="container">


<!-- DASHBOARD -->
<div id="dashboard" class="card">
  <div class="dashboard">
    <div class="stat">Produtos em estoque<span id="qtd">0</span></div>
    <div class="stat">Valor em estoque<span>R$ <span id="valorEstoque">0.00</span></span></div>
    <div class="stat">Lucro total<span>R$ <span id="lucro">0.00</span></span></div>
  </div>
</div>


<!-- CADASTRO -->
<div id="cadastro" class="card hidden">
  <input id="nomeProduto" placeholder="Nome do produto">
  <input id="valorCompra" type="number" placeholder="Valor de compra">
  <input type="file" accept="image/*" onchange="carregarImagem(event)">
  <button class="action" onclick="cadastrar()">Cadastrar Produto</button>
</div>


<!-- VENDA -->
<div id="venda" class="hidden"></div>


<!-- HISTÓRICO -->
<div id="historico" class="card hidden">


<select id="filtroMes" onchange="atualizarHistorico()">
  <option value="">Todos os meses</option>
  <option value="0">Janeiro</option>
  <option value="1">Fevereiro</option>
  <option value="2">Março</option>
  <option value="3">Abril</option>
  <option value="4">Maio</option>
  <option value="5">Junho</option>
  <option value="6">Julho</option>
  <option value="7">Agosto</option>
  <option value="8">Setembro</option>
  <option value="9">Outubro</option>
  <option value="10">Novembro</option>
  <option value="11">Dezembro</option>
</select>


<div id="historicoLista"></div>
</div>


</div>


<script>
let estoque=[];
let historico=[];
let lucroTotal=0;
let imagemTemp=null;


/* ===== STORAGE ===== */
function salvarDados(){
  localStorage.setItem("estoque",JSON.stringify(estoque));
  localStorage.setItem("historico",JSON.stringify(historico));
  localStorage.setItem("lucroTotal",lucroTotal);
}


function carregarDados(){
  estoque=JSON.parse(localStorage.getItem("estoque"))||[];
  historico=JSON.parse(localStorage.getItem("historico"))||[];
  lucroTotal=parseFloat(localStorage.getItem("lucroTotal"))||0;
  atualizarDashboard();
  atualizarHistorico();
}


/* ===== NAV ===== */
function mostrar(id){
  document.querySelectorAll('.card,#venda').forEach(e=>e.classList.add('hidden'));
  document.getElementById(id).classList.remove('hidden');
  if(id==="venda")renderVenda();
}


/* ===== CADASTRO ===== */
function carregarImagem(e){
  const r=new FileReader();
  r.onload=()=>imagemTemp=r.result;
  r.readAsDataURL(e.target.files[0]);
}


function cadastrar(){
  if(!nomeProduto.value||!valorCompra.value) return alert("Preencha tudo");
  estoque.push({nome:nomeProduto.value,compra:+valorCompra.value,imagem:imagemTemp});
  nomeProduto.value="";
  valorCompra.value="";
  imagemTemp=null;
  salvarDados();
  atualizarDashboard();
}


/* ===== VENDA ===== */
function renderVenda(){
  venda.innerHTML="";
  estoque.forEach((p,i)=>{
    venda.innerHTML+=`
    <div class="produto">
      <img src="${p.imagem||''}">
      <div>
        <strong>${p.nome}</strong><br>
        <small>Custo: R$ ${p.compra.toFixed(2)}</small>
        <input type="date" id="data-${i}">
        <input type="number" placeholder="Valor de venda" id="venda-${i}">
        <textarea placeholder="Nota / Detalhes" id="nota-${i}"></textarea>
        <button class="action" style="background:var(--success)" onclick="vender(${i})">Vender</button>
      </div>
    </div>`;
  });
}


function vender(i){
  const v=parseFloat(document.getElementById(`venda-${i}`).value);
  if(!v) return alert("Informe o valor");


  const p=estoque[i];
  const nota=document.getElementById(`nota-${i}`).value;
  const dataInput=document.getElementById(`data-${i}`).value;
  const dataVenda=dataInput?new Date(dataInput+"T12:00"):new Date();


  lucroTotal+=v-p.compra;


  historico.push({
    ...p,
    venda:v,
    nota,
    data:dataVenda.toLocaleDateString("pt-BR"),
    mes:dataVenda.getMonth(),
    ts:dataVenda.getTime()
  });


  estoque.splice(i,1);
  salvarDados();
  renderVenda();
  atualizarDashboard();
  atualizarHistorico();
}


/* ===== DASHBOARD ===== */
function atualizarDashboard(){
  qtd.textContent=estoque.length;
  valorEstoque.textContent=estoque.reduce((s,p)=>s+p.compra,0).toFixed(2);
  lucro.textContent=lucroTotal.toFixed(2);
}


/* ===== HISTÓRICO (ORDENADO POR DATA) ===== */
function atualizarHistorico(){
  const mes=filtroMes.value;
  historicoLista.innerHTML="";


  historico
    .sort((a,b)=>b.ts-a.ts)
    .filter(h=>mes===""||h.mes==mes)
    .forEach((h,i)=>{
      historicoLista.innerHTML+=`
      <div class="historico-item">
        <div class="historico-header">
          <img src="${h.imagem||''}">
          <strong onclick="toggleDetalhes(${i})">${h.nome}</strong>
          <div onclick="toggleDetalhes(${i})">${h.data}</div>
          <div class="seta" id="seta-${i}" onclick="toggleDetalhes(${i})">▶</div>
        </div>


        <div class="historico-detalhes" id="detalhes-${i}">
          <p>Compra: R$ ${h.compra.toFixed(2)}</p>
          <p>Venda: R$ ${h.venda.toFixed(2)}</p>
          <p>Lucro: R$ ${(h.venda-h.compra).toFixed(2)}</p>
          <p>Nota: ${h.nota||'-'}</p>
          <button class="action" style="background:var(--danger)" onclick="excluirVenda(${i})">Excluir</button>
        </div>
      </div>`;
    });
}


function toggleDetalhes(i){
  const d=document.getElementById(`detalhes-${i}`);
  const s=document.getElementById(`seta-${i}`);
  const aberto=d.style.display==="block";
  d.style.display=aberto?"none":"block";
  s.textContent=aberto?"▶":"▼";
}


function excluirVenda(i){
  if(!confirm("Excluir esta venda?")) return;
  const h=historico[i];
  lucroTotal-=(h.venda-h.compra);
  historico.splice(i,1);
  salvarDados();
  atualizarDashboard();
  atualizarHistorico();
}


/* INIT */
carregarDados();
</script>


</body>
</html>